#!/usr/bin/env bash
# --------------------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT license.
# --------------------------------------------------------------------------------------------
# usage: bin/build <layers dir> <platform dir> <plan path>
set -eo pipefail

layersDir=$1
platformDir=$2
planPath=$3
launchFile="$1/launch.toml"

echo "# Running 'oryx build .' in '`pwd`'..."

oryx build .

cat $3

echo "# Running 'oryx run-script' in '`pwd`'..."
runCommand=`oryx run-script --platform nodejs`

echo "# Generated run script:"
echo $runCommand
echo

echo "processes = [{ type = \"web\", command = \"$runCommand\" }]" > $launchFile
